"use strict";(self["webpackChunkcare"]=self["webpackChunkcare"]||[]).push([[645],{61499:(e,t,a)=>{a.d(t,{Z:()=>r});var o=a(15462);const n=class{};var l=function(e,t,a,o){function n(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,l){function i(e){try{d(o.next(e))}catch(t){l(t)}}function r(e){try{d(o["throw"](e))}catch(t){l(t)}}function d(e){e.done?a(e.value):n(e.value).then(i,r)}d((o=o.apply(e,t||[])).next())}))};class i extends n{constructor(){super(...arguments),this.baseUrl="https://my.tanda.co/api/v2"}getDepartments(){return l(this,void 0,void 0,(function*(){const e=yield o.Z.get(`${this.baseUrl}/departments`),t=[];return e.forEach((e=>{const a=e.name.split("|").slice(-1)[0];let o=t.find((e=>e.key==a));o?o.value.push({id:e.id,name:e.name}):(o={key:a,value:[{id:e.id,name:e.name}]},t.push(o))})),t.sort(((e,t)=>{const a=e.key.toUpperCase(),o=t.key.toUpperCase();return a<o?-1:a>o?1:0}))}))}getPublicHolidays(e){return l(this,void 0,void 0,(function*(){const t=yield o.Z.get(`${this.baseUrl}/public_holidays?regions=au_nsw&years=${e.join(",")}`);return t["au_nsw"]}))}getUsers(){return l(this,void 0,void 0,(function*(){const e=yield o.Z.get(`${this.baseUrl}/users`);return e.sort(((e,t)=>{const a=e.name.toUpperCase(),o=t.name.toUpperCase();return a<o?-1:a>o?1:0}))}))}getUserShifts(e){return l(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),a=parseInt(e.to.substring(0,4),10),n=[t];t!=a&&n.push(a);const l=yield this.getPublicHolidays(n),i=yield o.Z.get(`${this.baseUrl}/shifts`,{user_ids:[e.user_id],from:e.from,to:e.to,show_notes:!0});return i.filter((e=>"APPROVED"===e.status&&null===e.leave_request_id&&e.start&&e.finish)).map((e=>{var t;const a=new Date(Date.parse(e.date)),o=a.getDay();let n=0,i=0;null===(t=e.allowances)||void 0===t||t.map((e=>{var t,a;"Parking"==(null===e||void 0===e?void 0:e.name)?n=null!==(t=n+(null===e||void 0===e?void 0:e.value))&&void 0!==t?t:0:"Mileage"==(null===e||void 0===e?void 0:e.name)&&(i=null!==(a=i+(null===e||void 0===e?void 0:e.value))&&void 0!==a?a:0)}));const r=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),d=Number(((e.finish-e.start-r)/3600).toFixed(2)),s=l.findIndex((t=>t.date===e.date))>=0;return{date:e.date,weekday:!s&&1<=o&&o<=5?d:0,saturday:s||6!==o?0:d,sunday:s||0!==o?0:d,holiday:s?d:0,total:d,mileage:i,parking:n}})).reduce(((e,t)=>{let a=e.find((e=>e.date===t.date));return a?(a.weekday=a.weekday+t.weekday,a.saturday=a.saturday+t.saturday,a.sunday=a.sunday+t.sunday,a.holiday=a.holiday+t.holiday,a.total=a.total+t.total,a.mileage=a.mileage+t.mileage):(a=Object.assign({},t),e.push(a)),e}),[]).sort(((e,t)=>{const a=new Date(Date.parse(e.date)),o=new Date(Date.parse(t.date));return a<o?-1:a>o?1:0}))}))}getDepartmentShifts(e){return l(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),a=parseInt(e.to.substring(0,4),10),n=[t];t!=a&&n.push(a);const l=yield this.getPublicHolidays(n),i=yield o.Z.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to,show_notes:!0});return i.filter((t=>e.department_ids.indexOf(t.department_id)>=0&&"APPROVED"===t.status&&null===t.leave_request_id&&t.start&&t.finish)).map((e=>{var t;const a=new Date(Date.parse(e.date)),o=a.getDay();let n="",i=0,r=0;null===(t=e.allowances)||void 0===t||t.map((e=>{var t,a;n=null===e||void 0===e?void 0:e.name,(null===e||void 0===e?void 0:e.name.includes("Parking"))?i=null!==(t=i+(null===e||void 0===e?void 0:e.value))&&void 0!==t?t:0:(null===e||void 0===e?void 0:e.name.includes("Mileage"))&&(r=null!==(a=r+(null===e||void 0===e?void 0:e.value))&&void 0!==a?a:0)}));const d=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),s=l.findIndex((t=>t.date===e.date))>=0,u=(e.finish-e.start-d)/3600;return{key:`${e.date}|${e.department_id}`,departmentId:e.department_id,date:e.date,weekday:!s&&1<=o&&o<=5?u:0,saturday:s||6!==o?0:u,sunday:s||0!==o?0:u,holiday:s?u:0,hours:u,mileage:r,parking:i,allowanceName:n}})).filter((e=>e.hours>0)).reduce(((e,t)=>{let a=e.find((e=>e.key===t.key));return a?(a.weekday=a.weekday+t.weekday,a.saturday=a.saturday+t.saturday,a.sunday=a.sunday+t.sunday,a.holiday=a.holiday+t.holiday,a.hours=a.hours+t.hours,a.mileage=a.mileage+t.mileage,a.parking=a.parking+t.parking):(a=Object.assign({},t),e.push(a)),e}),[]).sort(((e,t)=>{const a=new Date(Date.parse(e.date)),o=new Date(Date.parse(t.date));return a<o?-1:a>o?1:0}))}))}getAllComments(e){return l(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),a=parseInt(e.to.substring(0,4),10),n=[t];t!=a&&n.push(a);const l=yield this.getDepartments(),i=yield o.Z.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to,show_notes:!0});return i.map((e=>{const t=l.find((t=>{const a=t.value.find((t=>t.id===e.department_id));return Boolean(a)}));return{name:null===t||void 0===t?void 0:t.key,date:e.date,notes:e.notes}}))}))}}const r=new i},66645:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var o=a(83673),n=a(98880),l=a(62323);const i=(0,o._)("h1",{class:"text-h4"},"Payrolls",-1),r={class:"row",style:{"margin-bottom":"15px"}},d={class:"col",style:{"padding-right":"10px"}},s=(0,o.Uk)(" No results "),u={class:"col",style:{"padding-left":"10px"}},p={class:"row items-center justify-end"},v=(0,o.Uk)("Summary");function c(e,t,a,c,m,y){const w=(0,o.up)("q-item-section"),f=(0,o.up)("q-item"),g=(0,o.up)("q-select"),h=(0,o.up)("q-btn"),k=(0,o.up)("q-date"),_=(0,o.up)("q-popup-proxy"),b=(0,o.up)("q-icon"),x=(0,o.up)("q-input"),U=(0,o.up)("q-form"),W=(0,o.up)("q-td"),Z=(0,o.up)("q-tr"),D=(0,o.up)("q-table"),P=(0,o.up)("q-card-section"),S=(0,o.up)("q-card"),F=(0,o.up)("q-page"),q=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(F,{class:"items-center justify-evenly",style:{padding:"40px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o.Wm)(P,null,{default:(0,o.w5)((()=>[i,(0,o.Wm)(U,{style:{width:"100%"},onSubmit:(0,n.iM)(e.onSubmit,["stop"])},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o._)("div",d,[(0,o.Wm)(g,{modelValue:e.user,"onUpdate:modelValue":t[0]||(t[0]=t=>e.user=t),label:"Staff",options:e.options,style:{width:"100%"}},{"no-option":(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"text-grey"},{default:(0,o.w5)((()=>[s])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),(0,o._)("div",u,[(0,o.Wm)(x,{label:"Date Range *","model-value":e.dateRangeFormatted},{append:(0,o.w5)((()=>[(0,o.Wm)(b,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{"transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{range:"",modelValue:e.dateRange,"onUpdate:modelValue":t[1]||(t[1]=t=>e.dateRange=t),mask:"YYYY-MM-DD"},{default:(0,o.w5)((()=>[(0,o._)("div",p,[(0,o.wy)((0,o.Wm)(h,{label:"Close",color:"primary",flat:""},null,512),[[q]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model-value"])])]),(0,o.Wm)(h,{label:"Load Timesheet",type:"submit",color:"primary",loading:e.loading,disable:!e.canSubmit},null,8,["loading","disable"])])),_:1},8,["onSubmit"]),(0,o.Wm)(D,{style:{"margin-top":"30px"},rows:e.rows,"row-key":"name",title:"Timesheet",color:"primary",loading:e.loading,"hide-pagination":!0,pagination:{rowsPerPage:100}},(0,o.Nv)({body:(0,o.w5)((e=>[(0,o.Wm)(Z,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{key:"date",props:e},{default:(0,o.w5)((()=>{var t,a,n,i;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.date)+" "+(0,l.zw)((null===e||void 0===e||null===(a=e.row)||void 0===a?void 0:a.holiday)>0?"(PUB)":(null===e||void 0===e||null===(n=e.row)||void 0===n?void 0:n.sunday)>0?"(SUN)":(null===e||void 0===e||null===(i=e.row)||void 0===i?void 0:i.saturday)>0?"(SAT)":""),1)]})),_:2},1032,["props"]),(0,o.Wm)(W,{key:"weekday",props:e},{default:(0,o.w5)((()=>{var t;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.weekday.toFixed(2)),1)]})),_:2},1032,["props"]),(0,o.Wm)(W,{key:"saturday",props:e},{default:(0,o.w5)((()=>{var t;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.saturday.toFixed(2)),1)]})),_:2},1032,["props"]),(0,o.Wm)(W,{key:"sunday",props:e},{default:(0,o.w5)((()=>{var t;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.sunday.toFixed(2)),1)]})),_:2},1032,["props"]),(0,o.Wm)(W,{key:"holiday",props:e},{default:(0,o.w5)((()=>{var t;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.holiday.toFixed(2)),1)]})),_:2},1032,["props"]),(0,o.Wm)(W,{key:"total",props:e},{default:(0,o.w5)((()=>{var t;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.total.toFixed(2)),1)]})),_:2},1032,["props"]),(0,o.Wm)(W,{key:"mileage",props:e},{default:(0,o.w5)((()=>{var t;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.mileage),1)]})),_:2},1032,["props"]),(0,o.Wm)(W,{key:"parking",props:e},{default:(0,o.w5)((()=>{var t;return[(0,o.Uk)((0,l.zw)(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.parking),1)]})),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},[e.rows.length>0?{name:"top-right",fn:(0,o.w5)((()=>[(0,o.Wm)(h,{color:"primary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:e.exportTable},null,8,["onClick"])]))}:void 0,e.rows.length>0?{name:"top-row",fn:(0,o.w5)((()=>[(0,o.Wm)(Z,{style:{background:"#eee","font-weight":"bold"}},{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[v])),_:1}),(0,o.Wm)(W,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.rows.reduce(((e,t)=>e+t.weekday),0).toFixed(2)),1)])),_:1}),(0,o.Wm)(W,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.rows.reduce(((e,t)=>e+t.saturday),0).toFixed(2)),1)])),_:1}),(0,o.Wm)(W,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.rows.reduce(((e,t)=>e+t.sunday),0).toFixed(2)),1)])),_:1}),(0,o.Wm)(W,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.rows.reduce(((e,t)=>e+t.holiday),0).toFixed(2)),1)])),_:1}),(0,o.Wm)(W,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.rows.reduce(((e,t)=>e+t.total),0).toFixed(2)),1)])),_:1}),(0,o.Wm)(W,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.rows.reduce(((e,t)=>e+t.mileage),0).toFixed(2)),1)])),_:1}),(0,o.Wm)(W,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.rows.reduce(((e,t)=>e+t.parking),0).toFixed(2)),1)])),_:1})])),_:1})]))}:void 0]),1032,["rows","loading"])])),_:1})])),_:1})])),_:1})}var m=a(61959),y=a(61499),w=a(12841),f=a(48825),g=a(85998),h=function(e,t,a,o){function n(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,l){function i(e){try{d(o.next(e))}catch(t){l(t)}}function r(e){try{d(o["throw"](e))}catch(t){l(t)}}function d(e){e.done?a(e.value):n(e.value).then(i,r)}d((o=o.apply(e,t||[])).next())}))};const k=(0,o.aZ)({components:{},setup(){const e=(0,f.Z)(),t=(0,m.iH)(!1),a=(0,m.iH)({from:"",to:""}),o=(0,m.iH)(null),n=(0,m.iH)([]),l=(0,m.iH)([]),i=(0,m.Fl)((()=>{var e,t,o,n;return(null===(e=a.value)||void 0===e?void 0:e.from)&&(null===(t=a.value)||void 0===t?void 0:t.to)?`${null===(o=a.value)||void 0===o?void 0:o.from} - ${null===(n=a.value)||void 0===n?void 0:n.to}`:""})),r=(0,m.Fl)((()=>{var e;return(null===(e=o.value)||void 0===e?void 0:e.value)&&a.value.from&&a.value.to}));function d(){var e;return h(this,void 0,void 0,(function*(){t.value=!0;try{const n=a.value.from.replace(/\//g,"-"),i=a.value.to.replace(/\//g,"-"),r=yield y.Z.getUserShifts({user_id:null===(e=o.value)||void 0===e?void 0:e.value,from:n,to:i});l.value=r}finally{setTimeout((()=>{t.value=!1}),500)}}))}function s(){var t;const n=["Date","Weekday","Saturday","Sunday","Holiday","Total","Mileage","Parking"],i={fields:n},r=new g.Parser(i),d=r.parse(l.value.map((e=>({Date:e.date,Weekday:e.weekday,Saturday:e.saturday,Sunday:e.sunday,Holiday:e.holiday,Total:e.total,Mileage:e.mileage,Parking:e.parking})))),s=(0,w.Z)(`${null===(t=o.value)||void 0===t?void 0:t.label}_${a.value.from}_${a.value.to}.csv`,d,"text/csv");!0!==s&&e.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return y.Z.getUsers().then((e=>{n.value=e.map((e=>({label:e.name,value:e.id})))})).catch((e=>{console.log(e)})),{loading:t,user:o,dateRange:a,dateRangeFormatted:i,options:n,rows:l,canSubmit:r,onSubmit:d,exportTable:s}}});var _=a(24379),b=a(10151),x=a(25589),U=a(68689),W=a(55666),Z=a(83414),D=a(52035),P=a(64689),S=a(24554),F=a(83944),q=a(93124),z=a(64607),Q=a(22659),$=a(18186),C=a(83884),I=a(60677),T=a(7518),H=a.n(T);k.render=c;const R=k;H()(k,"components",{QPage:_.Z,QCard:b.Z,QCardSection:x.Z,QForm:U.Z,QSelect:W.Z,QItem:Z.Z,QItemSection:D.Z,QInput:P.Z,QIcon:S.Z,QPopupProxy:F.Z,QDate:q.Z,QBtn:z.Z,QTable:Q.Z,QTr:$.Z,QTd:C.Z}),H()(k,"directives",{ClosePopup:I.Z})}}]);