"use strict";(self["webpackChunkcare"]=self["webpackChunkcare"]||[]).push([[64],{28180:(e,t,n)=>{n.d(t,{Z:()=>f});var r=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))};const o="care",i=1,s="inventoryItems",a="priceItems";function u(){return new Promise(((e,t)=>{const n=indexedDB.open(o,i);n.onsuccess=function(){e(this.result)},n.onerror=()=>t(),n.onupgradeneeded=function(e){const t=e.currentTarget.result,n=t.createObjectStore(s,{keyPath:"itemCode",autoIncrement:!1});n.createIndex("itemShortCode","itemShortCode",{unique:!1});const r=t.createObjectStore(a,{keyPath:"clientCode",autoIncrement:!1});r.createIndex("price","price",{unique:!1})}}))}function d(e,t){return r(this,void 0,void 0,(function*(){const n=yield u(),r=n.transaction(e,t);return r.objectStore(e)}))}function c(e,t){return r(this,void 0,void 0,(function*(){const n=yield d(e,t);return new Promise(((e,t)=>{const r=n.getAll();r.onsuccess=function(t){e(t.target.result)},r.onerror=t}))}))}function l(e){return r(this,void 0,void 0,(function*(){const t=yield d(e,"readwrite"),n=t.clear();return new Promise(((e,t)=>{n.onsuccess=()=>e(),n.onerror=t}))}))}const f={openDb:u,getObjectStore:d,clearObjectStore:l,getAll:c}},80966:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(28180),o=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))};const i="inventoryItems";class s{getInventoryItems(){return o(this,void 0,void 0,(function*(){return yield r.Z.getAll(i,"readonly")}))}saveInventoryItems(e){return o(this,void 0,void 0,(function*(){yield r.Z.clearObjectStore(i);const t=yield r.Z.getObjectStore(i,"readwrite");e.forEach((e=>{t.add(JSON.parse(JSON.stringify(e)))}))}))}}const a=new s},15156:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(28180),o=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))};const i="priceItems";class s{getPriceItems(){return o(this,void 0,void 0,(function*(){return yield r.Z.getAll(i,"readonly")}))}savePriceItems(e){return o(this,void 0,void 0,(function*(){yield r.Z.clearObjectStore(i);const t=yield r.Z.getObjectStore(i,"readwrite");e.forEach((e=>{t.put(Object.assign({},null!==e&&void 0!==e?e:{}))}))}))}}const a=new s},26999:(e,t,n)=>{n.d(t,{Z:()=>d});var r=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))};class o{constructor(){this.get=(e,t={})=>r(this,void 0,void 0,(function*(){const n=this.buildHeaders();let r=e;t&&(r=`${r}?${this.objectToQuerystring(t)}`);const o=yield fetch(r,{method:"GET",headers:n});return o.json()})),this.post=(e,t={})=>r(this,void 0,void 0,(function*(){const n=this.buildHeaders(),r=yield fetch(e,{method:"POST",headers:n,body:JSON.stringify(t)});return r.json()}))}objectToQuerystring(e){return Object.keys(e).map((t=>{const n=e[t];if("undefined"===typeof n)return null;let r="";if(n instanceof Array){if(0===n.length)return null;r=n.join(",")}else r=n instanceof String?n:n instanceof Number?n.toString():String(n);return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`})).filter((e=>e)).join("&")}buildHeaders(){const e={"Content-Type":"application/json"},t=window.localStorage.getItem("access_token");return t&&(e["Authorization"]=`Bearer ${t}`),e}}const i=new o,s=class{};var a=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))};class u extends s{constructor(){super(...arguments),this.baseUrl="https://my.tanda.co/api/v2"}getDepartments(){return a(this,void 0,void 0,(function*(){const e=yield i.get(`${this.baseUrl}/departments`),t=[];return e.forEach((e=>{const n=e.name.split("|").slice(-1)[0];let r=t.find((e=>e.key==n));r?r.value.push({id:e.id,name:e.name}):(r={key:n,value:[{id:e.id,name:e.name}]},t.push(r))})),t.sort(((e,t)=>{const n=e.key.toUpperCase(),r=t.key.toUpperCase();return n<r?-1:n>r?1:0}))}))}getPublicHolidays(e){return a(this,void 0,void 0,(function*(){const t=yield i.get(`${this.baseUrl}/public_holidays?regions=au_nsw&years=${e.join(",")}`);return t["au_nsw"]}))}getUsers(){return a(this,void 0,void 0,(function*(){const e=yield i.get(`${this.baseUrl}/users`);return e.sort(((e,t)=>{const n=e.name.toUpperCase(),r=t.name.toUpperCase();return n<r?-1:n>r?1:0}))}))}getUserShifts(e){return a(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),r=[t];t!=n&&r.push(n);const o=yield this.getPublicHolidays(r),s=yield i.get(`${this.baseUrl}/shifts`,{user_ids:[e.user_id],from:e.from,to:e.to,show_notes:!0});return s.filter((e=>"APPROVED"===e.status&&null===e.leave_request_id&&e.start&&e.finish)).map((e=>{var t;const n=new Date(Date.parse(e.date)),r=n.getDay();let i=0,s=0;null===(t=e.allowances)||void 0===t||t.map((e=>{var t,n;"Parking"==(null===e||void 0===e?void 0:e.name)?i=null!==(t=i+(null===e||void 0===e?void 0:e.value))&&void 0!==t?t:0:"Mileage"==(null===e||void 0===e?void 0:e.name)&&(s=null!==(n=s+(null===e||void 0===e?void 0:e.value))&&void 0!==n?n:0)}));const a=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),u=Number(((e.finish-e.start-a)/3600).toFixed(2)),d=o.findIndex((t=>t.date===e.date))>=0;return{date:e.date,weekday:!d&&1<=r&&r<=5?u:0,saturday:d||6!==r?0:u,sunday:d||0!==r?0:u,holiday:d?u:0,total:u,mileage:s,parking:i}})).reduce(((e,t)=>{let n=e.find((e=>e.date===t.date));return n?(n.weekday=n.weekday+t.weekday,n.saturday=n.saturday+t.saturday,n.sunday=n.sunday+t.sunday,n.holiday=n.holiday+t.holiday,n.total=n.total+t.total,n.mileage=n.mileage+t.mileage):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),r=new Date(Date.parse(t.date));return n<r?-1:n>r?1:0}))}))}getDepartmentShifts(e){return a(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),r=[t];t!=n&&r.push(n);const o=yield this.getPublicHolidays(r),s=yield i.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to,show_notes:!0});return s.filter((t=>e.department_ids.indexOf(t.department_id)>=0&&"APPROVED"===t.status&&null===t.leave_request_id&&t.start&&t.finish)).map((e=>{var t;const n=new Date(Date.parse(e.date)),r=n.getDay();let i="",s=0,a=0;null===(t=e.allowances)||void 0===t||t.map((e=>{var t,n;i=null===e||void 0===e?void 0:e.name,(null===e||void 0===e?void 0:e.name.includes("Parking"))?s=null!==(t=s+(null===e||void 0===e?void 0:e.value))&&void 0!==t?t:0:(null===e||void 0===e?void 0:e.name.includes("Mileage"))&&(a=null!==(n=a+(null===e||void 0===e?void 0:e.value))&&void 0!==n?n:0)}));const u=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),d=o.findIndex((t=>t.date===e.date))>=0,c=(e.finish-e.start-u)/3600;return{key:`${e.date}|${e.department_id}`,departmentId:e.department_id,date:e.date,weekday:!d&&1<=r&&r<=5?c:0,saturday:d||6!==r?0:c,sunday:d||0!==r?0:c,holiday:d?c:0,hours:c,mileage:a,parking:s,allowanceName:i}})).filter((e=>e.hours>0)).reduce(((e,t)=>{let n=e.find((e=>e.key===t.key));return n?(n.weekday=n.weekday+t.weekday,n.saturday=n.saturday+t.saturday,n.sunday=n.sunday+t.sunday,n.holiday=n.holiday+t.holiday,n.hours=n.hours+t.hours,n.mileage=n.mileage+t.mileage,n.parking=n.parking+t.parking):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),r=new Date(Date.parse(t.date));return n<r?-1:n>r?1:0}))}))}getAllComments(e){return a(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),r=[t];t!=n&&r.push(n);const o=yield this.getDepartments(),s=yield i.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to,show_notes:!0});return s.map((e=>{const t=o.find((t=>{const n=t.value.find((t=>t.id===e.department_id));return Boolean(n)}));return{name:null===t||void 0===t?void 0:t.key,date:e.date,notes:e.notes}}))}))}}const d=new u}}]);