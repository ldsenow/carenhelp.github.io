"use strict";(self["webpackChunkcare"]=self["webpackChunkcare"]||[]).push([[538],{28180:(e,t,n)=>{n.d(t,{Z:()=>m});var i=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{d(i.next(e))}catch(t){a(t)}}function l(e){try{d(i["throw"](e))}catch(t){a(t)}}function d(e){e.done?n(e.value):o(e.value).then(r,l)}d((i=i.apply(e,t||[])).next())}))};const o="care",a=1,r="inventoryItems",l="priceItems";function d(){return new Promise(((e,t)=>{const n=indexedDB.open(o,a);n.onsuccess=function(){e(this.result)},n.onerror=()=>t(),n.onupgradeneeded=function(e){const t=e.currentTarget.result,n=t.createObjectStore(r,{keyPath:"itemCode",autoIncrement:!1});n.createIndex("itemShortCode","itemShortCode",{unique:!1});const i=t.createObjectStore(l,{keyPath:"clientCode",autoIncrement:!1});i.createIndex("price","price",{unique:!1})}}))}function s(e,t){return i(this,void 0,void 0,(function*(){const n=yield d(),i=n.transaction(e,t);return i.objectStore(e)}))}function u(e,t){return i(this,void 0,void 0,(function*(){const n=yield s(e,t);return new Promise(((e,t)=>{const i=n.getAll();i.onsuccess=function(t){e(t.target.result)},i.onerror=t}))}))}function c(e){return i(this,void 0,void 0,(function*(){const t=yield s(e,"readwrite"),n=t.clear();return new Promise(((e,t)=>{n.onsuccess=()=>e(),n.onerror=t}))}))}const m={openDb:d,getObjectStore:s,clearObjectStore:c,getAll:u}},80966:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(28180),o=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{d(i.next(e))}catch(t){a(t)}}function l(e){try{d(i["throw"](e))}catch(t){a(t)}}function d(e){e.done?n(e.value):o(e.value).then(r,l)}d((i=i.apply(e,t||[])).next())}))};const a="inventoryItems";class r{getInventoryItems(){return o(this,void 0,void 0,(function*(){return yield i.Z.getAll(a,"readonly")}))}saveInventoryItems(e){return o(this,void 0,void 0,(function*(){yield i.Z.clearObjectStore(a);const t=yield i.Z.getObjectStore(a,"readwrite");e.forEach((e=>{t.add(JSON.parse(JSON.stringify(e)))}))}))}}const l=new r},15156:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(28180),o=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{d(i.next(e))}catch(t){a(t)}}function l(e){try{d(i["throw"](e))}catch(t){a(t)}}function d(e){e.done?n(e.value):o(e.value).then(r,l)}d((i=i.apply(e,t||[])).next())}))};const a="priceItems";class r{getPriceItems(){return o(this,void 0,void 0,(function*(){return yield i.Z.getAll(a,"readonly")}))}savePriceItems(e){return o(this,void 0,void 0,(function*(){yield i.Z.clearObjectStore(a);const t=yield i.Z.getObjectStore(a,"readwrite");e.forEach((e=>{t.put(Object.assign({},null!==e&&void 0!==e?e:{}))}))}))}}const l=new r},61499:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(15462);const o=class{};var a=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{d(i.next(e))}catch(t){a(t)}}function l(e){try{d(i["throw"](e))}catch(t){a(t)}}function d(e){e.done?n(e.value):o(e.value).then(r,l)}d((i=i.apply(e,t||[])).next())}))};class r extends o{constructor(){super(...arguments),this.baseUrl="https://my.tanda.co/api/v2"}getDepartments(){return a(this,void 0,void 0,(function*(){const e=yield i.Z.get(`${this.baseUrl}/departments`),t=[];return e.forEach((e=>{const n=e.name.split("|").slice(-1)[0];let i=t.find((e=>e.key==n));i?i.value.push({id:e.id,name:e.name}):(i={key:n,value:[{id:e.id,name:e.name}]},t.push(i))})),t.sort(((e,t)=>{const n=e.key.toUpperCase(),i=t.key.toUpperCase();return n<i?-1:n>i?1:0}))}))}getPublicHolidays(e){return a(this,void 0,void 0,(function*(){const t=yield i.Z.get(`${this.baseUrl}/public_holidays?regions=au_nsw&years=${e.join(",")}`);return t["au_nsw"]}))}getUsers(){return a(this,void 0,void 0,(function*(){const e=yield i.Z.get(`${this.baseUrl}/users`);return e.sort(((e,t)=>{const n=e.name.toUpperCase(),i=t.name.toUpperCase();return n<i?-1:n>i?1:0}))}))}getUserShifts(e){return a(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),o=[t];t!=n&&o.push(n);const a=yield this.getPublicHolidays(o),r=yield i.Z.get(`${this.baseUrl}/shifts`,{user_ids:[e.user_id],from:e.from,to:e.to,show_notes:!0});return r.filter((e=>"APPROVED"===e.status&&null===e.leave_request_id&&e.start&&e.finish)).map((e=>{var t;const n=new Date(Date.parse(e.date)),i=n.getDay();let o=0,r=0;null===(t=e.allowances)||void 0===t||t.map((e=>{var t,n;"Parking"==(null===e||void 0===e?void 0:e.name)?o=null!==(t=o+(null===e||void 0===e?void 0:e.value))&&void 0!==t?t:0:"Mileage"==(null===e||void 0===e?void 0:e.name)&&(r=null!==(n=r+(null===e||void 0===e?void 0:e.value))&&void 0!==n?n:0)}));const l=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),d=Number(((e.finish-e.start-l)/3600).toFixed(2)),s=a.findIndex((t=>t.date===e.date))>=0;return{date:e.date,weekday:!s&&1<=i&&i<=5?d:0,saturday:s||6!==i?0:d,sunday:s||0!==i?0:d,holiday:s?d:0,total:d,mileage:r,parking:o}})).reduce(((e,t)=>{let n=e.find((e=>e.date===t.date));return n?(n.weekday=n.weekday+t.weekday,n.saturday=n.saturday+t.saturday,n.sunday=n.sunday+t.sunday,n.holiday=n.holiday+t.holiday,n.total=n.total+t.total,n.mileage=n.mileage+t.mileage):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),i=new Date(Date.parse(t.date));return n<i?-1:n>i?1:0}))}))}getDepartmentShifts(e){return a(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),o=[t];t!=n&&o.push(n);const a=yield this.getPublicHolidays(o),r=yield i.Z.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to,show_notes:!0});return r.filter((t=>e.department_ids.indexOf(t.department_id)>=0&&"APPROVED"===t.status&&null===t.leave_request_id&&t.start&&t.finish)).map((e=>{var t;const n=new Date(Date.parse(e.date)),i=n.getDay();let o="",r=0,l=0;null===(t=e.allowances)||void 0===t||t.map((e=>{var t,n;o=null===e||void 0===e?void 0:e.name,(null===e||void 0===e?void 0:e.name.includes("Parking"))?r=null!==(t=r+(null===e||void 0===e?void 0:e.value))&&void 0!==t?t:0:(null===e||void 0===e?void 0:e.name.includes("Mileage"))&&(l=null!==(n=l+(null===e||void 0===e?void 0:e.value))&&void 0!==n?n:0)}));const d=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),s=a.findIndex((t=>t.date===e.date))>=0,u=(e.finish-e.start-d)/3600;return{key:`${e.date}|${e.department_id}`,departmentId:e.department_id,date:e.date,weekday:!s&&1<=i&&i<=5?u:0,saturday:s||6!==i?0:u,sunday:s||0!==i?0:u,holiday:s?u:0,hours:u,mileage:l,parking:r,allowanceName:o}})).filter((e=>e.hours>0)).reduce(((e,t)=>{let n=e.find((e=>e.key===t.key));return n?(n.weekday=n.weekday+t.weekday,n.saturday=n.saturday+t.saturday,n.sunday=n.sunday+t.sunday,n.holiday=n.holiday+t.holiday,n.hours=n.hours+t.hours,n.mileage=n.mileage+t.mileage,n.parking=n.parking+t.parking):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),i=new Date(Date.parse(t.date));return n<i?-1:n>i?1:0}))}))}getAllComments(e){return a(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),o=[t];t!=n&&o.push(n);const a=yield this.getDepartments(),r=yield i.Z.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to,show_notes:!0});return r.map((e=>{const t=a.find((t=>{const n=t.value.find((t=>t.id===e.department_id));return Boolean(n)}));return{name:null===t||void 0===t?void 0:t.key,date:e.date,notes:e.notes}}))}))}}const l=new r},58538:(e,t,n)=>{n.r(t),n.d(t,{default:()=>V});n(67280),n(65363),n(90246);var i=n(83673),o=n(98880),a=n(62323);const r=(0,i._)("h1",{class:"text-h4"},"Invoices",-1),l={class:"row q_m_b15"},d={class:"col q_p_r10"},s=(0,i.Uk)(" No results "),u={class:"col",style:{"padding-left":"10px"}},c={class:"row items-center justify-end"},m=(0,i.Uk)("Summary"),p=["innerHTML"],v={key:0,class:"text-center"},f={class:"q_old_price"},g={key:1,class:"text-center"};function h(e,t,n,h,y,w){const _=(0,i.up)("q-item-section"),b=(0,i.up)("q-item"),k=(0,i.up)("q-select"),C=(0,i.up)("q-btn"),I=(0,i.up)("q-date"),D=(0,i.up)("q-popup-proxy"),S=(0,i.up)("q-icon"),x=(0,i.up)("q-input"),P=(0,i.up)("q-form"),Z=(0,i.up)("q-td"),U=(0,i.up)("q-tr"),W=(0,i.up)("q-table"),T=(0,i.up)("q-card-section"),$=(0,i.up)("q-card"),q=(0,i.up)("q-page"),A=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(q,{class:"items-center justify-evenly q_p40"},{default:(0,i.w5)((()=>[(0,i.Wm)($,null,{default:(0,i.w5)((()=>[(0,i.Wm)(T,null,{default:(0,i.w5)((()=>[r,(0,i.Wm)(P,{class:"q_f_w",onSubmit:(0,o.iM)(e.onSubmit,["stop"])},{default:(0,i.w5)((()=>[(0,i._)("div",l,[(0,i._)("div",d,[(0,i.Wm)(k,{modelValue:e.department,"onUpdate:modelValue":t[0]||(t[0]=t=>e.department=t),label:"Client",options:e.options,class:"q_f_w"},{"no-option":(0,i.w5)((()=>[(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"text-grey"},{default:(0,i.w5)((()=>[s])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),(0,i._)("div",u,[(0,i.Wm)(x,{label:"Date Range *","model-value":e.dateRangeFormatted},{append:(0,i.w5)((()=>[(0,i.Wm)(S,{name:"event",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{"transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{range:"",modelValue:e.dateRange,"onUpdate:modelValue":t[1]||(t[1]=t=>e.dateRange=t),mask:"YYYY-MM-DD"},{default:(0,i.w5)((()=>[(0,i._)("div",c,[(0,i.wy)((0,i.Wm)(C,{label:"Close",color:"primary",flat:""},null,512),[[A]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model-value"])])]),(0,i.Wm)(C,{label:"Load Timesheet",type:"submit",color:"primary",loading:e.loading,disable:!e.canSubmit},null,8,["loading","disable"])])),_:1},8,["onSubmit"]),(0,i.Wm)(W,{style:{"margin-top":"30px"},columns:e.columns,rows:e.rows,"row-key":"name",title:"Timesheet",color:"primary",loading:e.loading,"hide-pagination":!0,pagination:{rowsPerPage:100}},(0,i.Nv)({body:(0,i.w5)((e=>[(0,i.Wm)(U,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{key:"date",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.row.date)+" "+(0,a.zw)(e.row.dateDescription?` (${e.row.dateDescription})`:""),1)])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"itemCode",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.row.itemCode),1)])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"itemShortCode",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.row.itemShortCode),1)])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"description",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",{innerHTML:e.row.description.replace(/(?:\r\n|\r|\n)/g,"<br/>")},null,8,p)])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"lateCancellation",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.row.lateCancellation?"Yes":"No"),1)])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"hours",props:e},{default:(0,i.w5)((()=>[e.row.price?((0,i.wg)(),(0,i.iD)("div",v,[(0,i._)("div",null,(0,a.zw)(e.row.price),1),(0,i._)("div",f,(0,a.zw)(e.row.unitPrice),1)])):((0,i.wg)(),(0,i.iD)("div",g,(0,a.zw)(e.row.unitPrice),1))])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"hours",props:e,class:"text-center"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.row.hours.toFixed(2)),1)])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"mileage",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.row.mileage),1)])),_:2},1032,["props"]),(0,i.Wm)(Z,{key:"parking",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.row.parking),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},[e.rows.length>0?{name:"top-right",fn:(0,i.w5)((()=>[(0,i.Wm)(C,{color:"primary","icon-right":"archive",label:"Export for Xero","no-caps":"",onClick:e.exportTable},null,8,["onClick"])]))}:void 0,e.rows.length>0?{name:"top-row",fn:(0,i.w5)((()=>[(0,i.Wm)(U,{style:{background:"#eee","font-weight":"bold"}},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{colspan:"6"},{default:(0,i.w5)((()=>[m])),_:1}),(0,i.Wm)(Z,{class:"text-right"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.hours),0))/100),1)])),_:1}),(0,i.Wm)(Z,{class:"text-right"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.mileage),0))/100),1)])),_:1}),(0,i.Wm)(Z,{class:"text-right"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.parking),0))/100),1)])),_:1})])),_:1})]))}:void 0]),1032,["columns","rows","loading"])])),_:1})])),_:1})])),_:1})}var y=n(61959),w=n(61499),_=n(80966),b=n(15156),k=n(12841),C=n(48825),I=n(85998),D=(n(50477),function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{d(i.next(e))}catch(t){a(t)}}function l(e){try{d(i["throw"](e))}catch(t){a(t)}}function d(e){e.done?n(e.value):o(e.value).then(r,l)}d((i=i.apply(e,t||[])).next())}))});const S=(0,i.aZ)({components:{},setup(){const e=(0,C.Z)(),t=(0,y.iH)(!1),n=(0,y.iH)({from:"",to:""}),i=(0,y.iH)(null),o=[{name:"date",field:"date",label:"Date",align:"left"},{name:"itemCode",field:"itemCode",label:"Item Code",align:"left"},{name:"itemShortCode",field:"itemShortCode",label:"Short Code",align:"left"},{name:"description",label:"Description",field:"description",align:"left",style:"width:500px; white-space: initial"},{name:"lateCancellation",field:"lateCancellation",label:"Cancellation",align:"center"},{name:"unitPrice",field:"unitPrice",label:"Unit Price",align:"center"},{name:"hours",field:"hours",label:"Hours",align:"right"},{name:"mileage",field:"mileage",label:"Mileage",align:"right"},{name:"parking",field:"parking",label:"Parking",align:"right"}],a=(0,y.iH)([]),r=(0,y.iH)([]),l=(0,y.iH)([]),d=(0,y.iH)([]),s=(0,y.Fl)((()=>{var e,t,i,o;return(null===(e=n.value)||void 0===e?void 0:e.from)&&(null===(t=n.value)||void 0===t?void 0:t.to)?`${null===(i=n.value)||void 0===i?void 0:i.from} - ${null===(o=n.value)||void 0===o?void 0:o.to}`:""})),u=(0,y.Fl)((()=>n.value.from&&n.value.to));function c(){var e;return D(this,void 0,void 0,(function*(){t.value=!0;try{const o=n.value.from.replace(/\//g,"-"),a=n.value.to.replace(/\//g,"-"),s=yield w.Z.getDepartmentShifts({department_ids:null===(e=i.value)||void 0===e?void 0:e.value.map((e=>e.id)),from:o,to:a});r.value=yield m(s),l.value=yield p(s),d.value=yield v(s)}finally{setTimeout((()=>{t.value=!1}),500)}}))}function m(e){return D(this,void 0,void 0,(function*(){const t=yield _.Z.getInventoryItems(),n=yield b.Z.getPriceItems();return e.map(((e,o)=>{var a,r,l,d,s;const u=null===(a=i.value)||void 0===a?void 0:a.value.find((t=>t.id===e.departmentId)),c=null===(r=n.find((e=>e.clientCode===(null===u||void 0===u?void 0:u.name))))||void 0===r?void 0:r.price;let m=(null===u||void 0===u?void 0:u.name.includes("|"))?u.name.split("|")[0]:"";const p=m.startsWith("L");m=p?m.substring(1):m;let v=m?t.find((e=>e.itemShortCode===m)):null;return m&&v||(v=(null===(l=e.allowanceName)||void 0===l?void 0:l.includes("Parking"))?"I"==(null===m||void 0===m?void 0:m.slice(0,1))?t.find((e=>"Insurance 8"===e.itemCode)):t.find((e=>"04_799_0104_6_1"===e.itemCode)):"I"==(null===m||void 0===m?void 0:m.slice(0,1))?t.find((e=>"Insurance 2"===e.itemCode)):t.find((e=>"04_590_0125_6_1"===e.itemCode))),{index:o,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===v||void 0===v?void 0:v.itemCode,itemShortCode:m,description:`${p?"Late Cancellation - ":""}${null!==(d=null===v||void 0===v?void 0:v.description)&&void 0!==d?d:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,parking:e.parking,lateCancellation:p,unitPrice:null!==(s=null===v||void 0===v?void 0:v.unitPrice)&&void 0!==s?s:0,price:c,salesAccount:null===v||void 0===v?void 0:v.salesAccount,salesTaxRate:null===v||void 0===v?void 0:v.salesTaxRate,is_mp:""}}))}))}function p(e){return D(this,void 0,void 0,(function*(){const t=yield _.Z.getInventoryItems(),n=yield b.Z.getPriceItems();return e.map(((e,o)=>{var a,r,l,d;const s=null===(a=i.value)||void 0===a?void 0:a.value.find((t=>t.id===e.departmentId)),u=null===(r=n.find((e=>e.clientCode===(null===s||void 0===s?void 0:s.name))))||void 0===r?void 0:r.price;let c=(null===s||void 0===s?void 0:s.name.includes("|"))?s.name.split("|")[0]:"",m="";const p=c.startsWith("L");c=p?c.substring(1):c;let v=c?t.find((e=>e.itemShortCode===c)):null;return e.mileage>0&&(v="I"==(null===c||void 0===c?void 0:c.slice(0,1))?t.find((e=>"Insurance 2"===e.itemCode)):t.find((e=>"04_590_0125_6_1"===e.itemCode)),m="m"),{index:o,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===v||void 0===v?void 0:v.itemCode,itemShortCode:c,description:`${p?"Late Cancellation - ":""}${null!==(l=null===v||void 0===v?void 0:v.description)&&void 0!==l?l:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,parking:e.parking,lateCancellation:p,unitPrice:null!==(d=null===v||void 0===v?void 0:v.unitPrice)&&void 0!==d?d:0,price:u,salesAccount:null===v||void 0===v?void 0:v.salesAccount,salesTaxRate:null===v||void 0===v?void 0:v.salesTaxRate,is_mp:m}})).filter((e=>e.mileage>0))}))}function v(e){return D(this,void 0,void 0,(function*(){const t=yield _.Z.getInventoryItems(),n=yield b.Z.getPriceItems();return e.map(((e,o)=>{var a,r,l;const d=null===(a=i.value)||void 0===a?void 0:a.value.find((t=>t.id===e.departmentId)),s=null===(r=n.find((e=>e.clientCode===(null===d||void 0===d?void 0:d.name))))||void 0===r?void 0:r.price;let u=(null===d||void 0===d?void 0:d.name.includes("|"))?d.name.split("|")[0]:"",c="";const m=u.startsWith("L");u=m?u.substring(1):u;let p=u?t.find((e=>e.itemShortCode===u)):null;return e.parking>0&&(p="I"==(null===u||void 0===u?void 0:u.slice(0,1))?t.find((e=>"Insurance 8"===e.itemCode)):t.find((e=>"04_799_0104_6_1"===e.itemCode)),c="p"),{index:o,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===p||void 0===p?void 0:p.itemCode,itemShortCode:u,description:`${m?"Late Cancellation - ":""}${null!==(l=null===p||void 0===p?void 0:p.description)&&void 0!==l?l:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,parking:1,lateCancellation:m,unitPrice:e.parking,price:s,salesAccount:null===p||void 0===p?void 0:p.salesAccount,salesTaxRate:null===p||void 0===p?void 0:p.salesTaxRate,is_mp:c}})).filter((e=>e.parking>0))}))}function f(){var t,o;const a=["*ContactName","*InvoiceNumber","Reference","*InvoiceDate","*DueDate","InventoryItemCode","*Description","*Quantity","*UnitAmount","*AccountCode","*TaxType"],s={fields:a},u=new I.Parser(s),c=null===(t=i.value)||void 0===t?void 0:t.label.trim(),m=new Date,p=new Intl.DateTimeFormat("en-AU").format(m),v=new Intl.DateTimeFormat("en-AU").format(new Date(m.setDate(m.getDate()+14))),f=`INV-${m.getFullYear().toString().substring(2)}${(m.getMonth()+1).toString().padStart(2,"0")}${m.getDay().toString().padStart(2,"0")}${m.getMilliseconds().toString().padStart(3,"0")}`;var g=[];r.value.map((e=>{var t,n;if(g.push(Object.assign({},e)),e.mileage>0||e.parking>0){var i=null===(t=null===l||void 0===l?void 0:l.value)||void 0===t?void 0:t.find((t=>t.date==e.date&&t.itemShortCode==e.itemShortCode)),o=null===(n=null===d||void 0===d?void 0:d.value)||void 0===n?void 0:n.find((t=>t.date==e.date&&t.itemShortCode==e.itemShortCode));i&&e.mileage>0&&g.push(Object.assign({},i)),o&&e.parking>0&&g.push(Object.assign({},o))}}));const h=u.parse(g.map((e=>{var t;return{"*ContactName":c,"*InvoiceNumber":f,Reference:"","*InvoiceDate":p,"*DueDate":v,InventoryItemCode:e.itemCode,"*Description":e.description,"*Quantity":"m"==e.is_mp?e.mileage:"p"==e.is_mp?e.parking:e.hours.toFixed(2),"*UnitAmount":Boolean(e.is_mp)?e.unitPrice:null!==(t=e.price)&&void 0!==t?t:e.unitPrice,"*AccountCode":e.salesAccount,"*TaxType":e.salesTaxRate}}))),y=(0,k.Z)(`${null===(o=i.value)||void 0===o?void 0:o.label}_${n.value.from}_${n.value.to}.csv`,h,"text/csv");!0!==y&&e.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return w.Z.getDepartments().then((e=>{a.value=e.map((e=>({label:e.key,value:e.value})))})),{loading:t,department:i,dateRange:n,dateRangeFormatted:s,options:a,columns:o,rows:r,mileageRows:l,parkingRows:d,canSubmit:u,onSubmit:c,exportTable:f}}});var x=n(24379),P=n(10151),Z=n(25589),U=n(68689),W=n(55666),T=n(83414),$=n(52035),q=n(64689),A=n(24554),j=n(83944),O=n(93124),Q=n(64607),R=n(22659),N=n(18186),z=n(83884),H=n(5363),M=n(60677),F=n(7518),L=n.n(F);S.render=h;const V=S;L()(S,"components",{QPage:x.Z,QCard:P.Z,QCardSection:Z.Z,QForm:U.Z,QSelect:W.Z,QItem:T.Z,QItemSection:$.Z,QInput:q.Z,QIcon:A.Z,QPopupProxy:j.Z,QDate:O.Z,QBtn:Q.Z,QTable:R.Z,QTr:N.Z,QTd:z.Z,QTooltip:H.Z}),L()(S,"directives",{ClosePopup:M.Z})}}]);