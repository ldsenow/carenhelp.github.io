(self["webpackChunkcare"]=self["webpackChunkcare"]||[]).push([[411],{9257:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var o=function(e,t,n,o){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(t){i(t)}}function s(e){try{l(o["throw"](e))}catch(t){i(t)}}function l(e){e.done?n(e.value):a(e.value).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const a="care",i=1,r="inventoryItems";function s(){return new Promise(((e,t)=>{const n=indexedDB.open(a,i);n.onsuccess=function(){e(this.result)},n.onerror=()=>t(),n.onupgradeneeded=function(e){const t=e.currentTarget.result,n=t.createObjectStore(r,{keyPath:"itemCode",autoIncrement:!1});n.createIndex("itemShortCode","itemShortCode",{unique:!1})}}))}function l(e,t){return o(this,void 0,void 0,(function*(){const n=yield s(),o=n.transaction(e,t);return o.objectStore(e)}))}function d(e,t){return o(this,void 0,void 0,(function*(){const n=yield l(e,t);return new Promise(((e,t)=>{const o=n.getAll();o.onsuccess=function(t){e(t.target.result)},o.onerror=t}))}))}function u(e){return o(this,void 0,void 0,(function*(){const t=yield l(e,"readwrite"),n=t.clear();return new Promise(((e,t)=>{n.onsuccess=()=>e(),n.onerror=t}))}))}const c={openDb:s,getObjectStore:l,clearObjectStore:u,getAll:d};var m=function(e,t,n,o){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(t){i(t)}}function s(e){try{l(o["throw"](e))}catch(t){i(t)}}function l(e){e.done?n(e.value):a(e.value).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const p="inventoryItems";class f{getInventoryItems(){return m(this,void 0,void 0,(function*(){return yield c.getAll(p,"readonly")}))}saveInventoryItems(e){return m(this,void 0,void 0,(function*(){yield c.clearObjectStore(p);const t=yield c.getObjectStore(p,"readwrite");e.forEach((e=>{t.add(JSON.parse(JSON.stringify(e)))}))}))}}const v=new f},1499:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var o=n(5462);const a=class{};var i=function(e,t,n,o){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(t){i(t)}}function s(e){try{l(o["throw"](e))}catch(t){i(t)}}function l(e){e.done?n(e.value):a(e.value).then(r,s)}l((o=o.apply(e,t||[])).next())}))};class r extends a{constructor(){super(...arguments),this.baseUrl="https://my.tanda.co/api/v2"}getDepartments(){return i(this,void 0,void 0,(function*(){const e=yield o.Z.get(`${this.baseUrl}/departments`),t=[];return e.forEach((e=>{const n=e.name.split("|").slice(-1)[0];let o=t.find((e=>e.key==n));o?o.value.push({id:e.id,name:e.name}):(o={key:n,value:[{id:e.id,name:e.name}]},t.push(o))})),t.sort(((e,t)=>{const n=e.key.toUpperCase(),o=t.key.toUpperCase();return n<o?-1:n>o?1:0}))}))}getPublicHolidays(e){return i(this,void 0,void 0,(function*(){const t=yield o.Z.get(`${this.baseUrl}/public_holidays?regions=au_nsw&years=${e.join(",")}`);return t["au_nsw"]}))}getUsers(){return i(this,void 0,void 0,(function*(){const e=yield o.Z.get(`${this.baseUrl}/users`);return e.sort(((e,t)=>{const n=e.name.toUpperCase(),o=t.name.toUpperCase();return n<o?-1:n>o?1:0}))}))}getUserShifts(e){return i(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),a=[t];t!=n&&a.push(n);const i=yield this.getPublicHolidays(a),r=yield o.Z.get(`${this.baseUrl}/shifts`,{user_ids:[e.user_id],from:e.from,to:e.to,show_notes:!0});return r.filter((e=>"APPROVED"===e.status&&null===e.leave_request_id&&e.start&&e.finish)).map((e=>{const t=new Date(Date.parse(e.date)),n=t.getDay(),o=Math.round(10*e.allowances.reduce(((e,t)=>e+t.value),0))/10,a=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),r=Math.round((e.finish-e.start-a)/360)/10,s=i.findIndex((t=>t.date===e.date))>=0;return{date:e.date,weekday:!s&&1<=n&&n<=5?r:0,saturday:s||6!==n?0:r,sunday:s||0!==n?0:r,holiday:s?r:0,total:r,mileage:o}})).reduce(((e,t)=>{let n=e.find((e=>e.date===t.date));return n?(n.weekday=Math.round(10*(n.weekday+t.weekday))/10,n.saturday=Math.round(10*(n.saturday+t.saturday))/10,n.sunday=Math.round(10*(n.sunday+t.sunday))/10,n.holiday=Math.round(10*(n.holiday+t.holiday))/10,n.total=Math.round(10*(n.total+t.total))/10,n.mileage=Math.round(10*(n.mileage+t.mileage))/10):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),o=new Date(Date.parse(t.date));return n<o?-1:n>o?1:0}))}))}getDepartmentShifts(e){return i(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),a=[t];t!=n&&a.push(n);const i=yield this.getPublicHolidays(a),r=yield o.Z.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to,show_notes:!0});return r.filter((t=>e.department_ids.indexOf(t.department_id)>=0&&"APPROVED"===t.status&&null===t.leave_request_id&&t.start&&t.finish)).map((e=>{const t=new Date(Date.parse(e.date)),n=t.getDay(),o=e.allowances.reduce(((e,t)=>e+t.value),0),a=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),r=i.findIndex((t=>t.date===e.date))>=0,s=(e.finish-e.start-a)/3600;return{key:`${e.date}|${e.department_id}`,departmentId:e.department_id,date:e.date,weekday:!r&&1<=n&&n<=5?s:0,saturday:r||6!==n?0:s,sunday:r||0!==n?0:s,holiday:r?s:0,hours:s,mileage:o}})).filter((e=>e.hours>0)).reduce(((e,t)=>{let n=e.find((e=>e.key===t.key));return n?(n.weekday=n.weekday+t.weekday,n.saturday=n.saturday+t.saturday,n.sunday=n.sunday+t.sunday,n.holiday=n.holiday+t.holiday,n.hours=n.hours+t.hours,n.mileage=n.mileage+t.mileage):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),o=new Date(Date.parse(t.date));return n<o?-1:n>o?1:0}))}))}}const s=new r},3411:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>O});n(7280),n(5363),n(246),n(107);var o=n(3673),a=n(8880),i=n(2323);const r=(0,o.Wm)("h1",{class:"text-h4"},"Invoices",-1),s={class:"row",style:{"margin-bottom":"15px"}},l={class:"col",style:{"padding-right":"10px"}},d=(0,o.Uk)(" No results "),u={class:"col",style:{"padding-left":"10px"}},c={class:"row items-center justify-end"},m=(0,o.Uk)("Summary");function p(e,t,n,p,f,v){const h=(0,o.up)("q-item-section"),y=(0,o.up)("q-item"),w=(0,o.up)("q-select"),g=(0,o.up)("q-btn"),b=(0,o.up)("q-date"),k=(0,o.up)("q-popup-proxy"),C=(0,o.up)("q-icon"),D=(0,o.up)("q-input"),_=(0,o.up)("q-form"),S=(0,o.up)("q-td"),x=(0,o.up)("q-tr"),I=(0,o.up)("q-table"),W=(0,o.up)("q-card-section"),U=(0,o.up)("q-card"),Z=(0,o.up)("q-page"),P=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(Z,{class:"items-center justify-evenly",style:{padding:"40px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[r,(0,o.Wm)(_,{style:{width:"100%"},onSubmit:(0,a.iM)(e.onSubmit,["stop"])},{default:(0,o.w5)((()=>[(0,o.Wm)("div",s,[(0,o.Wm)("div",l,[(0,o.Wm)(w,{modelValue:e.department,"onUpdate:modelValue":t[1]||(t[1]=t=>e.department=t),label:"Client",options:e.options,style:{width:"100%"}},{"no-option":(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,{class:"text-grey"},{default:(0,o.w5)((()=>[d])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),(0,o.Wm)("div",u,[(0,o.Wm)(D,{label:"Date Range *","model-value":e.dateRangeFormatted},{append:(0,o.w5)((()=>[(0,o.Wm)(C,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{"transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{range:"",modelValue:e.dateRange,"onUpdate:modelValue":t[2]||(t[2]=t=>e.dateRange=t),mask:"YYYY-MM-DD"},{default:(0,o.w5)((()=>[(0,o.Wm)("div",c,[(0,o.wy)((0,o.Wm)(g,{label:"Close",color:"primary",flat:""},null,512),[[P]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model-value"])])]),(0,o.Wm)(g,{label:"Load Timesheet",type:"submit",color:"primary",loading:e.loading,disable:!e.canSubmit},null,8,["loading","disable"])])),_:1},8,["onSubmit"]),(0,o.Wm)(I,{style:{"margin-top":"30px"},columns:e.columns,rows:e.rows,"row-key":"name",title:"Timesheet",color:"primary",loading:e.loading,"hide-pagination":!0,pagination:{rowsPerPage:100}},(0,o.Nv)({body:(0,o.w5)((e=>[(0,o.Wm)(x,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{key:"date",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.row.date)+" "+(0,i.zw)(e.row.dateDescription?` (${e.row.dateDescription})`:""),1)])),_:2},1032,["props"]),(0,o.Wm)(S,{key:"itemCode",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.row.itemCode),1)])),_:2},1032,["props"]),(0,o.Wm)(S,{key:"itemShortCode",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.row.itemShortCode),1)])),_:2},1032,["props"]),(0,o.Wm)(S,{key:"description",props:e},{default:(0,o.w5)((()=>[(0,o.Wm)("div",{innerHTML:e.row.description.replace(/(?:\r\n|\r|\n)/g,"<br/>")},null,8,["innerHTML"])])),_:2},1032,["props"]),(0,o.Wm)(S,{key:"lateCancellation",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.row.lateCancellation?"Yes":"No"),1)])),_:2},1032,["props"]),(0,o.Wm)(S,{key:"hours",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.row.hours),1)])),_:2},1032,["props"]),(0,o.Wm)(S,{key:"mileage",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.row.mileage),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},[e.rows.length>0?{name:"top-right",fn:(0,o.w5)((()=>[(0,o.Wm)(g,{color:"primary","icon-right":"archive",label:"Export for Xero","no-caps":"",onClick:e.exportTable},null,8,["onClick"])]))}:void 0,e.rows.length>0?{name:"top-row",fn:(0,o.w5)((()=>[(0,o.Wm)(x,{style:{background:"#eee","font-weight":"bold"}},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{colspan:"5"},{default:(0,o.w5)((()=>[m])),_:1}),(0,o.Wm)(S,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.hours),0))/100),1)])),_:1}),(0,o.Wm)(S,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.mileage),0))/100),1)])),_:1})])),_:1})]))}:void 0]),1032,["columns","rows","loading"])])),_:1})])),_:1})])),_:1})}var f=n(1959),v=n(1499),h=n(9257),y=n(2841),w=n(8825),g=n(5998),b=function(e,t,n,o){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(t){i(t)}}function s(e){try{l(o["throw"](e))}catch(t){i(t)}}function l(e){e.done?n(e.value):a(e.value).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const k=(0,o.aZ)({components:{},setup(){const e=(0,w.Z)(),t=(0,f.iH)(!1),n=(0,f.iH)({from:"",to:""}),a=(0,f.iH)(null),i=[{name:"date",field:"date",label:"Date",align:"left"},{name:"itemCode",field:"itemCode",label:"Item Code",align:"left"},{name:"itemShortCode",field:"itemShortCode",label:"Short Code",align:"left"},{name:"description",label:"Description",field:"description",align:"left",style:"width:500px; white-space: initial"},{name:"lateCancellation",field:"lateCancellation",label:"Cancellation",align:"center"},{name:"hours",field:"hours",label:"Hours",align:"right"},{name:"mileage",field:"mileage",label:"Mileage",align:"right"}],r=(0,f.iH)([]),s=(0,o.Fl)((()=>{var e,t,o,a;return(null===(e=n.value)||void 0===e?void 0:e.from)&&(null===(t=n.value)||void 0===t?void 0:t.to)?`${null===(o=n.value)||void 0===o?void 0:o.from} - ${null===(a=n.value)||void 0===a?void 0:a.to}`:""})),l=(0,o.Fl)((()=>n.value.from&&n.value.to));v.Z.getDepartments().then((e=>{r.value=e.map((e=>({label:e.key,value:e.value})))}));const d=(0,f.iH)([]);function u(){var e;return b(this,void 0,void 0,(function*(){t.value=!0;try{const o=n.value.from.replace(/\//g,"-"),i=n.value.to.replace(/\//g,"-"),r=yield v.Z.getDepartmentShifts({department_ids:null===(e=a.value)||void 0===e?void 0:e.value.map((e=>e.id)),from:o,to:i});d.value=yield c(r)}finally{setTimeout((()=>{t.value=!1}),500)}}))}function c(e){return b(this,void 0,void 0,(function*(){const t=yield h.Z.getInventoryItems();return e.map(((e,n)=>{var o,i,r;const s=null===(o=a.value)||void 0===o?void 0:o.value.find((t=>t.id===e.departmentId));let l=(null===s||void 0===s?void 0:s.name.includes("|"))?s.name.split("|")[0]:"";const d=l.startsWith("L");l=d?l.substring(1):l;const u=l?t.find((e=>e.itemShortCode===l)):null;return{index:n,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===u||void 0===u?void 0:u.itemCode,itemShortCode:l,description:`${d?"Late Cancellation - ":""}${null!==(i=null===u||void 0===u?void 0:u.description)&&void 0!==i?i:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,lateCancellation:d,unitPrice:null!==(r=null===u||void 0===u?void 0:u.unitPrice)&&void 0!==r?r:0,salesAccount:null===u||void 0===u?void 0:u.salesAccount,salesTaxRate:null===u||void 0===u?void 0:u.salesTaxRate}}))}))}function m(){var t,o;const i=["*ContactName","*InvoiceNumber","Reference","*InvoiceDate","*DueDate","InventoryItemCode","*Description","*Quantity","*UnitAmount","*AccountCode","*TaxType"],r={fields:i},s=new g.Parser(r),l=null===(t=a.value)||void 0===t?void 0:t.label.trim(),u=new Date,c=new Intl.DateTimeFormat("en-AU").format(u),m=`INV-${u.getFullYear().toString().substring(2)}${(u.getMonth()+1).toString().padStart(2,"0")}${u.getDay().toString().padStart(2,"0")}${u.getMilliseconds().toString().padStart(3,"0")}`,p=s.parse(d.value.map((e=>({"*ContactName":l,"*InvoiceNumber":m,Reference:"","*InvoiceDate":c,"*DueDate":c,InventoryItemCode:e.itemCode,"*Description":e.description,"*Quantity":e.hours,"*UnitAmount":e.unitPrice,"*AccountCode":e.salesAccount,"*TaxType":e.salesTaxRate})))),f=(0,y.Z)(`${null===(o=a.value)||void 0===o?void 0:o.label}_${n.value.from}_${n.value.to}.csv`,p,"text/csv");!0!==f&&e.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return{loading:t,department:a,dateRange:n,dateRangeFormatted:s,options:r,columns:i,rows:d,canSubmit:l,onSubmit:u,exportTable:m}}});var C=n(4379),D=n(151),_=n(5589),S=n(5269),x=n(5666),I=n(3414),W=n(2035),U=n(4689),Z=n(4554),P=n(3944),$=n(3124),T=n(4607),q=n(2659),M=n(8186),Q=n(3884),A=n(677),R=n(7518),j=n.n(R);k.render=p;const O=k;j()(k,"components",{QPage:C.Z,QCard:D.Z,QCardSection:_.Z,QForm:S.Z,QSelect:x.Z,QItem:I.Z,QItemSection:W.Z,QInput:U.Z,QIcon:Z.Z,QPopupProxy:P.Z,QDate:$.Z,QBtn:T.Z,QTable:q.Z,QTr:M.Z,QTd:Q.Z}),j()(k,"directives",{ClosePopup:A.Z})}}]);