(self["webpackChunkcare"]=self["webpackChunkcare"]||[]).push([[757],{9257:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var a=function(e,t,n,a){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{s(a.next(e))}catch(t){i(t)}}function l(e){try{s(a["throw"](e))}catch(t){i(t)}}function s(e){e.done?n(e.value):o(e.value).then(r,l)}s((a=a.apply(e,t||[])).next())}))};const o="care",i=1,r="inventoryItems";function l(){return new Promise(((e,t)=>{const n=indexedDB.open(o,i);n.onsuccess=function(){e(this.result)},n.onerror=()=>t(),n.onupgradeneeded=function(e){const t=e.currentTarget.result,n=t.createObjectStore(r,{keyPath:"itemCode",autoIncrement:!1});n.createIndex("itemShortCode","itemShortCode",{unique:!1})}}))}function s(e,t){return a(this,void 0,void 0,(function*(){const n=yield l(),a=n.transaction(e,t);return a.objectStore(e)}))}function d(e,t){return a(this,void 0,void 0,(function*(){const n=yield s(e,t);return new Promise(((e,t)=>{const a=n.getAll();a.onsuccess=function(t){e(t.target.result)},a.onerror=t}))}))}function u(e){return a(this,void 0,void 0,(function*(){const t=yield s(e,"readwrite"),n=t.clear();return new Promise(((e,t)=>{n.onsuccess=()=>e(),n.onerror=t}))}))}const c={openDb:l,getObjectStore:s,clearObjectStore:u,getAll:d};var m=function(e,t,n,a){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{s(a.next(e))}catch(t){i(t)}}function l(e){try{s(a["throw"](e))}catch(t){i(t)}}function s(e){e.done?n(e.value):o(e.value).then(r,l)}s((a=a.apply(e,t||[])).next())}))};const p="inventoryItems";class f{getInventoryItems(){return m(this,void 0,void 0,(function*(){return yield c.getAll(p,"readonly")}))}saveInventoryItems(e){return m(this,void 0,void 0,(function*(){yield c.clearObjectStore(p);const t=yield c.getObjectStore(p,"readwrite");e.forEach((e=>{t.add(JSON.parse(JSON.stringify(e)))}))}))}}const v=new f},1499:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(5462);const o=class{};var i=function(e,t,n,a){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{s(a.next(e))}catch(t){i(t)}}function l(e){try{s(a["throw"](e))}catch(t){i(t)}}function s(e){e.done?n(e.value):o(e.value).then(r,l)}s((a=a.apply(e,t||[])).next())}))};class r extends o{constructor(){super(...arguments),this.baseUrl="https://my.tanda.co/api/v2"}getDepartments(){return i(this,void 0,void 0,(function*(){const e=yield a.Z.get(`${this.baseUrl}/departments`),t=[];return e.forEach((e=>{const n=e.name.split("|").slice(-1)[0];let a=t.find((e=>e.key==n));a?a.value.push({id:e.id,name:e.name}):(a={key:n,value:[{id:e.id,name:e.name}]},t.push(a))})),t.sort(((e,t)=>{const n=e.key.toUpperCase(),a=t.key.toUpperCase();return n<a?-1:n>a?1:0}))}))}getPublicHolidays(e){return i(this,void 0,void 0,(function*(){const t=yield a.Z.get(`${this.baseUrl}/public_holidays?regions=au_nsw&years=${e.join(",")}`);return t["au_nsw"]}))}getUsers(){return i(this,void 0,void 0,(function*(){const e=yield a.Z.get(`${this.baseUrl}/users`);return e.sort(((e,t)=>{const n=e.name.toUpperCase(),a=t.name.toUpperCase();return n<a?-1:n>a?1:0}))}))}getUserShifts(e){return i(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),o=[t];t!=n&&o.push(n);const i=yield this.getPublicHolidays(o),r=yield a.Z.get(`${this.baseUrl}/shifts`,{user_ids:[e.user_id],from:e.from,to:e.to});return r.filter((e=>"APPROVED"===e.status&&null===e.leave_request_id&&e.start&&e.finish)).map((e=>{const t=new Date(Date.parse(e.date)),n=t.getDay(),a=Math.round(10*e.allowances.reduce(((e,t)=>e+t.value),0))/10,o=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),r=Math.round((e.finish-e.start-o)/360)/10,l=i.findIndex((t=>t.date===e.date))>=0;return{date:e.date,weekday:!l&&1<=n&&n<=5?r:0,saturday:l||6!==n?0:r,sunday:l||0!==n?0:r,holiday:l?r:0,total:r,mileage:a}})).reduce(((e,t)=>{let n=e.find((e=>e.date===t.date));return n?(n.weekday=Math.round(10*(n.weekday+t.weekday))/10,n.saturday=Math.round(10*(n.saturday+t.saturday))/10,n.sunday=Math.round(10*(n.sunday+t.sunday))/10,n.holiday=Math.round(10*(n.holiday+t.holiday))/10,n.total=Math.round(10*(n.total+t.total))/10,n.mileage=Math.round(10*(n.mileage+t.mileage))/10):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),a=new Date(Date.parse(t.date));return n<a?-1:n>a?1:0}))}))}getDepartmentShifts(e){return i(this,void 0,void 0,(function*(){const t=parseInt(e.from.substring(0,4),10),n=parseInt(e.to.substring(0,4),10),o=[t];t!=n&&o.push(n);const i=yield this.getPublicHolidays(o),r=yield a.Z.get(`${this.baseUrl}/shifts`,{from:e.from,to:e.to});return r.filter((t=>e.department_ids.indexOf(t.department_id)>=0&&"APPROVED"===t.status&&null===t.leave_request_id&&t.start&&t.finish)).map((e=>{const t=new Date(Date.parse(e.date)),n=t.getDay(),a=e.allowances.reduce(((e,t)=>e+t.value),0),o=e.breaks.map((e=>e.finish-e.start)).reduce(((e,t)=>e+t),0),r=i.findIndex((t=>t.date===e.date))>=0,l=(e.finish-e.start-o)/3600;return{key:`${e.date}|${e.department_id}`,departmentId:e.department_id,date:e.date,weekday:!r&&1<=n&&n<=5?l:0,saturday:r||6!==n?0:l,sunday:r||0!==n?0:l,holiday:r?l:0,hours:l,mileage:a}})).filter((e=>e.hours>0)).reduce(((e,t)=>{let n=e.find((e=>e.key===t.key));return n?(n.weekday=n.weekday+t.weekday,n.saturday=n.saturday+t.saturday,n.sunday=n.sunday+t.sunday,n.holiday=n.holiday+t.holiday,n.hours=n.hours+t.hours,n.mileage=n.mileage+t.mileage):(n=Object.assign({},t),e.push(n)),e}),[]).sort(((e,t)=>{const n=new Date(Date.parse(e.date)),a=new Date(Date.parse(t.date));return n<a?-1:n>a?1:0}))}))}}const l=new r},6757:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>j});n(7280),n(5363),n(246),n(107);var a=n(3673),o=n(8880),i=n(2323);const r={class:"row",style:{"margin-bottom":"15px"}},l={class:"col",style:{"padding-right":"10px"}},s=(0,a.Uk)(" No results "),d={class:"col",style:{"padding-left":"10px"}},u={class:"row items-center justify-end"},c=(0,a.Uk)("Summary");function m(e,t,n,m,p,f){const v=(0,a.up)("q-item-section"),y=(0,a.up)("q-item"),h=(0,a.up)("q-select"),g=(0,a.up)("q-btn"),w=(0,a.up)("q-date"),b=(0,a.up)("q-popup-proxy"),k=(0,a.up)("q-icon"),C=(0,a.up)("q-input"),D=(0,a.up)("q-form"),_=(0,a.up)("q-td"),S=(0,a.up)("q-tr"),x=(0,a.up)("q-table"),I=(0,a.up)("q-card-section"),W=(0,a.up)("q-card"),U=(0,a.up)("q-page"),Z=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(U,{class:"items-center justify-evenly",style:{padding:"40px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(W,null,{default:(0,a.w5)((()=>[(0,a.Wm)(I,null,{default:(0,a.w5)((()=>[(0,a.Wm)(D,{style:{width:"100%"},onSubmit:(0,o.iM)(e.onSubmit,["stop"])},{default:(0,a.w5)((()=>[(0,a.Wm)("div",r,[(0,a.Wm)("div",l,[(0,a.Wm)(h,{modelValue:e.department,"onUpdate:modelValue":t[1]||(t[1]=t=>e.department=t),label:"Client",options:e.options,style:{width:"100%"}},{"no-option":(0,a.w5)((()=>[(0,a.Wm)(y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(v,{class:"text-grey"},{default:(0,a.w5)((()=>[s])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),(0,a.Wm)("div",d,[(0,a.Wm)(C,{label:"Date Range *","model-value":e.dateRangeFormatted},{append:(0,a.w5)((()=>[(0,a.Wm)(k,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{range:"",modelValue:e.dateRange,"onUpdate:modelValue":t[2]||(t[2]=t=>e.dateRange=t),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a.Wm)("div",u,[(0,a.wy)((0,a.Wm)(g,{label:"Close",color:"primary",flat:""},null,512),[[Z]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model-value"])])]),(0,a.Wm)(g,{label:"Load Timesheet",type:"submit",color:"primary",loading:e.loading,disable:!e.canSubmit},null,8,["loading","disable"])])),_:1},8,["onSubmit"]),(0,a.Wm)(x,{style:{"margin-top":"30px"},columns:e.columns,rows:e.rows,"row-key":"name",title:"Timesheet",color:"primary",loading:e.loading,"hide-pagination":!0,pagination:{rowsPerPage:100}},(0,a.Nv)({body:(0,a.w5)((e=>[(0,a.Wm)(S,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{key:"date",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.row.date)+" "+(0,i.zw)(e.row.dateDescription?` (${e.row.dateDescription})`:""),1)])),_:2},1032,["props"]),(0,a.Wm)(_,{key:"itemCode",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.row.itemCode),1)])),_:2},1032,["props"]),(0,a.Wm)(_,{key:"itemShortCode",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.row.itemShortCode),1)])),_:2},1032,["props"]),(0,a.Wm)(_,{key:"description",props:e},{default:(0,a.w5)((()=>[(0,a.Wm)("div",{innerHTML:e.row.description.replace(/(?:\r\n|\r|\n)/g,"<br/>")},null,8,["innerHTML"])])),_:2},1032,["props"]),(0,a.Wm)(_,{key:"lateCancellation",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.row.lateCancellation?"Yes":"No"),1)])),_:2},1032,["props"]),(0,a.Wm)(_,{key:"hours",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.row.hours),1)])),_:2},1032,["props"]),(0,a.Wm)(_,{key:"mileage",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.row.mileage),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},[e.rows.length>0?{name:"top-right",fn:(0,a.w5)((()=>[(0,a.Wm)(g,{color:"primary","icon-right":"archive",label:"Export for Xero","no-caps":"",onClick:e.exportTable},null,8,["onClick"])]))}:void 0,e.rows.length>0?{name:"top-row",fn:(0,a.w5)((()=>[(0,a.Wm)(S,{style:{background:"#eee","font-weight":"bold"}},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{colspan:"5"},{default:(0,a.w5)((()=>[c])),_:1}),(0,a.Wm)(_,{class:"text-right"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.hours),0))/100),1)])),_:1}),(0,a.Wm)(_,{class:"text-right"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.mileage),0))/100),1)])),_:1})])),_:1})]))}:void 0]),1032,["columns","rows","loading"])])),_:1})])),_:1})])),_:1})}var p=n(1959),f=n(1499),v=n(9257),y=n(2841),h=n(8825),g=n(5998),w=function(e,t,n,a){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{s(a.next(e))}catch(t){i(t)}}function l(e){try{s(a["throw"](e))}catch(t){i(t)}}function s(e){e.done?n(e.value):o(e.value).then(r,l)}s((a=a.apply(e,t||[])).next())}))};const b=(0,a.aZ)({components:{},setup(){const e=(0,h.Z)(),t=(0,p.iH)(!1),n=(0,p.iH)({from:"",to:""}),o=(0,p.iH)(null),i=[{name:"date",field:"date",label:"Date",align:"left"},{name:"itemCode",field:"itemCode",label:"Item Code",align:"left"},{name:"itemShortCode",field:"itemShortCode",label:"Short Code",align:"left"},{name:"description",label:"Description",field:"description",align:"left",style:"width:500px; white-space: initial"},{name:"lateCancellation",field:"lateCancellation",label:"Cancellation",align:"center"},{name:"hours",field:"hours",label:"Hours",align:"right"},{name:"mileage",field:"mileage",label:"Mileage",align:"right"}],r=(0,p.iH)([]),l=(0,a.Fl)((()=>{var e,t,a,o;return(null===(e=n.value)||void 0===e?void 0:e.from)&&(null===(t=n.value)||void 0===t?void 0:t.to)?`${null===(a=n.value)||void 0===a?void 0:a.from} - ${null===(o=n.value)||void 0===o?void 0:o.to}`:""})),s=(0,a.Fl)((()=>n.value.from&&n.value.to));f.Z.getDepartments().then((e=>{r.value=e.map((e=>({label:e.key,value:e.value})))}));const d=(0,p.iH)([]);function u(){var e;return w(this,void 0,void 0,(function*(){t.value=!0;try{const a=n.value.from.replace(/\//g,"-"),i=n.value.to.replace(/\//g,"-"),r=yield f.Z.getDepartmentShifts({department_ids:null===(e=o.value)||void 0===e?void 0:e.value.map((e=>e.id)),from:a,to:i});d.value=yield c(r)}finally{setTimeout((()=>{t.value=!1}),500)}}))}function c(e){return w(this,void 0,void 0,(function*(){const t=yield v.Z.getInventoryItems();return e.map(((e,n)=>{var a,i,r;const l=null===(a=o.value)||void 0===a?void 0:a.value.find((t=>t.id===e.departmentId));let s=(null===l||void 0===l?void 0:l.name.includes("|"))?l.name.split("|")[0]:"";const d=s.startsWith("L");s=d?s.substring(1):s;const u=s?t.find((e=>e.itemShortCode===s)):null;return{index:n,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===u||void 0===u?void 0:u.itemCode,itemShortCode:s,description:`${d?"Late Cancellation - ":""}${null!==(i=null===u||void 0===u?void 0:u.description)&&void 0!==i?i:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,lateCancellation:d,unitPrice:null!==(r=null===u||void 0===u?void 0:u.unitPrice)&&void 0!==r?r:0,salesAccount:null===u||void 0===u?void 0:u.salesAccount,salesTaxRate:null===u||void 0===u?void 0:u.salesTaxRate}}))}))}function m(){var t,a;const i=["*ContactName","*InvoiceNumber","Reference","*InvoiceDate","*DueDate","InventoryItemCode","*Description","*Quantity","*UnitAmount","*AccountCode","*TaxType"],r={fields:i},l=new g.Parser(r),s=null===(t=o.value)||void 0===t?void 0:t.label.trim(),u=new Date,c=new Intl.DateTimeFormat("en-AU").format(u),m=`INV-${u.getFullYear().toString().substring(2)}${(u.getMonth()+1).toString().padStart(2,"0")}${u.getDay().toString().padStart(2,"0")}${u.getMilliseconds().toString().padStart(3,"0")}`,p=l.parse(d.value.map((e=>({"*ContactName":s,"*InvoiceNumber":m,Reference:"","*InvoiceDate":c,"*DueDate":c,InventoryItemCode:e.itemCode,"*Description":e.description,"*Quantity":e.hours,"*UnitAmount":e.unitPrice,"*AccountCode":e.salesAccount,"*TaxType":e.salesTaxRate})))),f=(0,y.Z)(`${null===(a=o.value)||void 0===a?void 0:a.label}_${n.value.from}_${n.value.to}.csv`,p,"text/csv");!0!==f&&e.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return{loading:t,department:o,dateRange:n,dateRangeFormatted:l,options:r,columns:i,rows:d,canSubmit:s,onSubmit:u,exportTable:m}}});var k=n(4379),C=n(151),D=n(5589),_=n(5269),S=n(5666),x=n(3414),I=n(2035),W=n(4689),U=n(4554),Z=n(3944),P=n(3124),$=n(4607),T=n(2659),q=n(8186),M=n(3884),Q=n(677),A=n(7518),R=n.n(A);b.render=m;const j=b;R()(b,"components",{QPage:k.Z,QCard:C.Z,QCardSection:D.Z,QForm:_.Z,QSelect:S.Z,QItem:x.Z,QItemSection:I.Z,QInput:W.Z,QIcon:U.Z,QPopupProxy:Z.Z,QDate:P.Z,QBtn:$.Z,QTable:T.Z,QTr:q.Z,QTd:M.Z}),R()(b,"directives",{ClosePopup:Q.Z})}}]);