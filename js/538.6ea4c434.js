"use strict";(self["webpackChunkcare"]=self["webpackChunkcare"]||[]).push([[538],{58538:(e,t,i)=>{i.r(t),i.d(t,{default:()=>B});i(67280),i(65363),i(90246);var o=i(83673),n=i(98880),l=i(62323);const a=(0,o._)("h1",{class:"text-h4"},"Invoices",-1),d={class:"row q_m_b15"},r={class:"col q_p_r10"},u=(0,o.Uk)(" No results "),s={class:"col",style:{"padding-left":"10px"}},c={class:"row items-center justify-end"},m=(0,o.Uk)("Summary"),p=["innerHTML"],v={key:0,class:"text-center"},g={class:"q_old_price"},f={key:1,class:"text-center"};function w(e,t,i,w,h,_){const y=(0,o.up)("q-item-section"),C=(0,o.up)("q-item"),k=(0,o.up)("q-select"),b=(0,o.up)("q-btn"),S=(0,o.up)("q-date"),I=(0,o.up)("q-popup-proxy"),x=(0,o.up)("q-icon"),D=(0,o.up)("q-input"),W=(0,o.up)("q-form"),P=(0,o.up)("q-td"),Z=(0,o.up)("q-tr"),T=(0,o.up)("q-table"),U=(0,o.up)("q-card-section"),q=(0,o.up)("q-card"),Q=(0,o.up)("q-page"),$=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(Q,{class:"items-center justify-evenly q_p40"},{default:(0,o.w5)((()=>[(0,o.Wm)(q,null,{default:(0,o.w5)((()=>[(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[a,(0,o.Wm)(W,{class:"q_f_w",onSubmit:(0,n.iM)(e.onSubmit,["stop"])},{default:(0,o.w5)((()=>[(0,o._)("div",d,[(0,o._)("div",r,[(0,o.Wm)(k,{modelValue:e.department,"onUpdate:modelValue":t[0]||(t[0]=t=>e.department=t),label:"Client",options:e.options,class:"q_f_w"},{"no-option":(0,o.w5)((()=>[(0,o.Wm)(C,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{class:"text-grey"},{default:(0,o.w5)((()=>[u])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),(0,o._)("div",s,[(0,o.Wm)(D,{label:"Date Range *","model-value":e.dateRangeFormatted},{append:(0,o.w5)((()=>[(0,o.Wm)(x,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(I,{"transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{range:"",modelValue:e.dateRange,"onUpdate:modelValue":t[1]||(t[1]=t=>e.dateRange=t),mask:"YYYY-MM-DD"},{default:(0,o.w5)((()=>[(0,o._)("div",c,[(0,o.wy)((0,o.Wm)(b,{label:"Close",color:"primary",flat:""},null,512),[[$]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model-value"])])]),(0,o.Wm)(b,{label:"Load Timesheet",type:"submit",color:"primary",loading:e.loading,disable:!e.canSubmit},null,8,["loading","disable"])])),_:1},8,["onSubmit"]),(0,o.Wm)(T,{style:{"margin-top":"30px"},columns:e.columns,rows:e.rows,"row-key":"name",title:"Timesheet",color:"primary",loading:e.loading,"hide-pagination":!0,pagination:{rowsPerPage:100}},(0,o.Nv)({body:(0,o.w5)((e=>[(0,o.Wm)(Z,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{key:"date",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.date)+" "+(0,l.zw)(e.row.dateDescription?` (${e.row.dateDescription})`:""),1)])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"itemCode",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.itemCode),1)])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"itemShortCode",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.itemShortCode),1)])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"description",props:e},{default:(0,o.w5)((()=>[(0,o._)("div",{innerHTML:e.row.description.replace(/(?:\r\n|\r|\n)/g,"<br/>")},null,8,p)])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"lateCancellation",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.lateCancellation?"Yes":"No"),1)])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"hours",props:e},{default:(0,o.w5)((()=>[e.row.price?((0,o.wg)(),(0,o.iD)("div",v,[(0,o._)("div",null,(0,l.zw)(e.row.price),1),(0,o._)("div",g,(0,l.zw)(e.row.unitPrice),1)])):((0,o.wg)(),(0,o.iD)("div",f,(0,l.zw)(e.row.unitPrice),1))])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"hours",props:e,class:"text-center"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.hours.toFixed(2)),1)])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"mileage",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.mileage),1)])),_:2},1032,["props"]),(0,o.Wm)(P,{key:"parking",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.row.parking),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},[e.rows.length>0?{name:"top-right",fn:(0,o.w5)((()=>[(0,o.Wm)(b,{color:"primary","icon-right":"archive",label:"Export for Xero","no-caps":"",onClick:e.exportTable},null,8,["onClick"])]))}:void 0,e.rows.length>0?{name:"top-row",fn:(0,o.w5)((()=>[(0,o.Wm)(Z,{style:{background:"#eee","font-weight":"bold"}},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{colspan:"6"},{default:(0,o.w5)((()=>[m])),_:1}),(0,o.Wm)(P,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.hours),0))/100),1)])),_:1}),(0,o.Wm)(P,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.mileage),0))/100),1)])),_:1}),(0,o.Wm)(P,{class:"text-right"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(Math.round(100*e.rows.reduce(((e,t)=>e+t.parking),0))/100),1)])),_:1})])),_:1})]))}:void 0]),1032,["columns","rows","loading"])])),_:1})])),_:1})])),_:1})}var h=i(61959),_=i(26999),y=i(80966),C=i(15156),k=i(12841),b=i(48825),S=i(85998),I=(i(50477),function(e,t,i,o){function n(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,l){function a(e){try{r(o.next(e))}catch(t){l(t)}}function d(e){try{r(o["throw"](e))}catch(t){l(t)}}function r(e){e.done?i(e.value):n(e.value).then(a,d)}r((o=o.apply(e,t||[])).next())}))});const x=(0,o.aZ)({components:{},setup(){const e=(0,b.Z)(),t=(0,h.iH)(!1),i=(0,h.iH)({from:"",to:""}),o=(0,h.iH)(null),n=[{name:"date",field:"date",label:"Date",align:"left"},{name:"itemCode",field:"itemCode",label:"Item Code",align:"left"},{name:"itemShortCode",field:"itemShortCode",label:"Short Code",align:"left"},{name:"description",label:"Description",field:"description",align:"left",style:"width:500px; white-space: initial"},{name:"lateCancellation",field:"lateCancellation",label:"Cancellation",align:"center"},{name:"unitPrice",field:"unitPrice",label:"Unit Price",align:"center"},{name:"hours",field:"hours",label:"Hours",align:"right"},{name:"mileage",field:"mileage",label:"Mileage",align:"right"},{name:"parking",field:"parking",label:"Parking",align:"right"}],l=(0,h.iH)([]),a=(0,h.iH)([]),d=(0,h.iH)([]),r=(0,h.iH)([]),u=(0,h.Fl)((()=>{var e,t,o,n;return(null===(e=i.value)||void 0===e?void 0:e.from)&&(null===(t=i.value)||void 0===t?void 0:t.to)?`${null===(o=i.value)||void 0===o?void 0:o.from} - ${null===(n=i.value)||void 0===n?void 0:n.to}`:""})),s=(0,h.Fl)((()=>i.value.from&&i.value.to));function c(){var e;return I(this,void 0,void 0,(function*(){t.value=!0;try{const n=i.value.from.replace(/\//g,"-"),l=i.value.to.replace(/\//g,"-"),u=yield _.Z.getDepartmentShifts({department_ids:null===(e=o.value)||void 0===e?void 0:e.value.map((e=>e.id)),from:n,to:l});a.value=yield m(u),d.value=yield p(u),r.value=yield v(u)}finally{setTimeout((()=>{t.value=!1}),500)}}))}function m(e){return I(this,void 0,void 0,(function*(){const t=yield y.Z.getInventoryItems(),i=yield C.Z.getPriceItems();return e.map(((e,n)=>{var l,a,d,r,u;const s=null===(l=o.value)||void 0===l?void 0:l.value.find((t=>t.id===e.departmentId)),c=null===(a=i.find((e=>e.clientCode===(null===s||void 0===s?void 0:s.name))))||void 0===a?void 0:a.price;let m=(null===s||void 0===s?void 0:s.name.includes("|"))?s.name.split("|")[0]:"";const p=m.startsWith("L");m=p?m.substring(1):m;let v=m?t.find((e=>e.itemShortCode===m)):null;return m&&v||(v=(null===(d=e.allowanceName)||void 0===d?void 0:d.includes("Parking"))?"I"==(null===m||void 0===m?void 0:m.slice(0,1))?t.find((e=>"Insurance 8"===e.itemCode)):t.find((e=>"04_799_0104_6_1"===e.itemCode)):"I"==(null===m||void 0===m?void 0:m.slice(0,1))?t.find((e=>"Insurance 2"===e.itemCode)):t.find((e=>"04_590_0125_6_1"===e.itemCode))),{index:n,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===v||void 0===v?void 0:v.itemCode,itemShortCode:m,description:`${p?"Late Cancellation - ":""}${null!==(r=null===v||void 0===v?void 0:v.description)&&void 0!==r?r:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,parking:e.parking,lateCancellation:p,unitPrice:null!==(u=null===v||void 0===v?void 0:v.unitPrice)&&void 0!==u?u:0,price:c,salesAccount:null===v||void 0===v?void 0:v.salesAccount,salesTaxRate:null===v||void 0===v?void 0:v.salesTaxRate,is_mp:""}}))}))}function p(e){return I(this,void 0,void 0,(function*(){const t=yield y.Z.getInventoryItems(),i=yield C.Z.getPriceItems();return e.map(((e,n)=>{var l,a,d,r;const u=null===(l=o.value)||void 0===l?void 0:l.value.find((t=>t.id===e.departmentId)),s=null===(a=i.find((e=>e.clientCode===(null===u||void 0===u?void 0:u.name))))||void 0===a?void 0:a.price;let c=(null===u||void 0===u?void 0:u.name.includes("|"))?u.name.split("|")[0]:"",m="";const p=c.startsWith("L");c=p?c.substring(1):c;let v=c?t.find((e=>e.itemShortCode===c)):null;return e.mileage>0&&(v="I"==(null===c||void 0===c?void 0:c.slice(0,1))?t.find((e=>"Insurance 2"===e.itemCode)):t.find((e=>"04_590_0125_6_1"===e.itemCode)),m="m"),{index:n,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===v||void 0===v?void 0:v.itemCode,itemShortCode:c,description:`${p?"Late Cancellation - ":""}${null!==(d=null===v||void 0===v?void 0:v.description)&&void 0!==d?d:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,parking:e.parking,lateCancellation:p,unitPrice:null!==(r=null===v||void 0===v?void 0:v.unitPrice)&&void 0!==r?r:0,price:s,salesAccount:null===v||void 0===v?void 0:v.salesAccount,salesTaxRate:null===v||void 0===v?void 0:v.salesTaxRate,is_mp:m}})).filter((e=>e.mileage>0))}))}function v(e){return I(this,void 0,void 0,(function*(){const t=yield y.Z.getInventoryItems(),i=yield C.Z.getPriceItems();return e.map(((e,n)=>{var l,a,d;const r=null===(l=o.value)||void 0===l?void 0:l.value.find((t=>t.id===e.departmentId)),u=null===(a=i.find((e=>e.clientCode===(null===r||void 0===r?void 0:r.name))))||void 0===a?void 0:a.price;let s=(null===r||void 0===r?void 0:r.name.includes("|"))?r.name.split("|")[0]:"",c="";const m=s.startsWith("L");s=m?s.substring(1):s;let p=s?t.find((e=>e.itemShortCode===s)):null;return e.parking>0&&(p="I"==(null===s||void 0===s?void 0:s.slice(0,1))?t.find((e=>"Insurance 8"===e.itemCode)):t.find((e=>"04_799_0104_6_1"===e.itemCode)),c="p"),{index:n,date:e.date,dateDescription:e.holiday>0?"PUB":e.sunday>0?"SUN":e.saturday>0?"SAT":"",itemCode:null===p||void 0===p?void 0:p.itemCode,itemShortCode:s,description:`${m?"Late Cancellation - ":""}${null!==(d=null===p||void 0===p?void 0:p.description)&&void 0!==d?d:""}\nDate: ${e.date}`,hours:e.hours,mileage:e.mileage,parking:1,lateCancellation:m,unitPrice:e.parking,price:u,salesAccount:null===p||void 0===p?void 0:p.salesAccount,salesTaxRate:null===p||void 0===p?void 0:p.salesTaxRate,is_mp:c}})).filter((e=>e.parking>0))}))}function g(){var t,n;const l=["*ContactName","*InvoiceNumber","Reference","*InvoiceDate","*DueDate","InventoryItemCode","*Description","*Quantity","*UnitAmount","*AccountCode","*TaxType"],u={fields:l},s=new S.Parser(u),c=null===(t=o.value)||void 0===t?void 0:t.label.trim(),m=new Date,p=new Intl.DateTimeFormat("en-AU").format(m),v=new Intl.DateTimeFormat("en-AU").format(new Date(m.setDate(m.getDate()+14))),g=`INV-${m.getFullYear().toString().substring(2)}${(m.getMonth()+1).toString().padStart(2,"0")}${m.getDay().toString().padStart(2,"0")}${m.getMilliseconds().toString().padStart(3,"0")}`;var f=[];a.value.map((e=>{var t,i;if(f.push(Object.assign({},e)),e.mileage>0||e.parking>0){var o=null===(t=null===d||void 0===d?void 0:d.value)||void 0===t?void 0:t.find((t=>t.date==e.date&&t.itemShortCode==e.itemShortCode)),n=null===(i=null===r||void 0===r?void 0:r.value)||void 0===i?void 0:i.find((t=>t.date==e.date&&t.itemShortCode==e.itemShortCode));o&&e.mileage>0&&f.push(Object.assign({},o)),n&&e.parking>0&&f.push(Object.assign({},n))}}));const w=s.parse(f.map((e=>{var t;return{"*ContactName":c,"*InvoiceNumber":g,Reference:"","*InvoiceDate":p,"*DueDate":v,InventoryItemCode:e.itemCode,"*Description":e.description,"*Quantity":"m"==e.is_mp?e.mileage:"p"==e.is_mp?e.parking:e.hours.toFixed(2),"*UnitAmount":Boolean(e.is_mp)?e.unitPrice:null!==(t=e.price)&&void 0!==t?t:e.unitPrice,"*AccountCode":e.salesAccount,"*TaxType":e.salesTaxRate}}))),h=(0,k.Z)(`${null===(n=o.value)||void 0===n?void 0:n.label}_${i.value.from}_${i.value.to}.csv`,w,"text/csv");!0!==h&&e.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return _.Z.getDepartments().then((e=>{l.value=e.map((e=>({label:e.key,value:e.value})))})),{loading:t,department:o,dateRange:i,dateRangeFormatted:u,options:l,columns:n,rows:a,mileageRows:d,parkingRows:r,canSubmit:s,onSubmit:c,exportTable:g}}});var D=i(24379),W=i(10151),P=i(25589),Z=i(68689),T=i(55666),U=i(83414),q=i(52035),Q=i(64689),$=i(24554),R=i(83944),A=i(93124),z=i(64607),N=i(22659),M=i(18186),F=i(83884),H=i(5363),L=i(60677),V=i(7518),j=i.n(V);x.render=w;const B=x;j()(x,"components",{QPage:D.Z,QCard:W.Z,QCardSection:P.Z,QForm:Z.Z,QSelect:T.Z,QItem:U.Z,QItemSection:q.Z,QInput:Q.Z,QIcon:$.Z,QPopupProxy:R.Z,QDate:A.Z,QBtn:z.Z,QTable:N.Z,QTr:M.Z,QTd:F.Z,QTooltip:H.Z}),j()(x,"directives",{ClosePopup:L.Z})}}]);